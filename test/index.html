<!DOCTYPE html>
<!-- saved from url=(0057)https://www.swiper.com.cn/demo/070-pagination-custom.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <title>Swiper demo</title>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"> -->
     <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
  <!-- Link Swiper's CSS -->
  <link rel="stylesheet" href="css/swiper.min.css">
   <link rel="stylesheet" href="css/3in1.css">
   <link rel="stylesheet" href="css/ranking.css">
   <link rel="stylesheet" href="css/task.css">
  <!-- Demo styles -->
  <style>
    * {
        margin: 0;
        padding:0;
    }
    html, body {
      position: relative;
      height: 100%;
    }
    body {
      background: #eee;
      font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
      font-size: 14px;
      color:#000;
      margin: 0;
      padding: 0;
    }
    .swiper-container {
      width: 100%;
      height: 100%;
    }
    .swiper-slide {
      text-align: center;
      font-size: 18px;
      background: #fff;

      /* Center slide text vertically */
      display: -webkit-box;
      display: -ms-flexbox;
      display: -webkit-flex;
      display: flex;
      -webkit-box-pack: center;
      -ms-flex-pack: center;
      -webkit-justify-content: center;
      justify-content: center;
      -webkit-box-align: center;
      -ms-flex-align: center;
      -webkit-align-items: center;
      align-items: center;
    }
    .swiper-pagination-bullet {
      width: 20px;
      height: 20px;
      text-align: center;
      line-height: 20px;
      font-size: 12px;
      color:#000;
      opacity: 1;
      background: rgba(0,0,0,0.2);
    }
    .swiper-pagination-bullet-active {
      color:#fff;
      background: #007aff;
    }
    iframe {
        width:100%;
        height:100%;
    }

    .bullets-box {
        padding-top:15px;
        padding-bottom:10px;
        opacity:0;
        transition:1s;
    }
    .bullets-box:hover{
        opacity:1;
    }
    .set {
      position:absolute;
      top: 0;
      z-index: 5;
      width:200px;
      height:100%;
      /* background:rgba(0, 0, 0, 0.11); */

    }
    .set button {
      width:50px;
    }
    .set h1 {
      margin-bottom: 20px;
      text-align: center;
    }
    .set-box {
      padding:40px 20px 0 20px;
      height:100%;
      background:#fff;
      box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.19);
      opacity:0;
      transition:1s;
    }
    .set:hover .set-box {
      opacity:1;

    }
    #autoplay {
      width:100%;
      height:50px;
      background:#fff;
      border:none;
      box-shadow: 1px 2px 6px 1px #ddd;
      border-radius:5px;
      cursor:pointer;
    }
  </style>
</head>
<body>
  <!-- Swiper -->
  <div class="swiper-container swiper-container-horizontal">
    <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(-3840px, 0px, 0px);">
      <div class="swiper-slide slide1" style="width: 1920px;">
          <!-- 排行榜 -->
            <div class="wrap">
              <div class="title">
                <span>
                  打字练习排行榜
                  <img src="images/crown.png" alt="crown">
                </span>
              </div>
              <div class="ranking-wrap">
                <ul id="ranking">
                </ul>
              </div>
            </div>
          <!-- 排行榜 -->

      </div>
      <div class="swiper-slide swiper-slide-prev" style="width: 1920px;">

          <!-- 第二页-->
            <div id="main">
                <div class="chart__md">
                    <div id="barChart"></div>
                </div>
                <div class="content__md">
                    <div>
                        <table class="tab__mod">
                            <thead>
                            <tr>
                                <td><p>名字</p></td>
                                <td><p>分数</p></td>
                            </tr>
                            </thead>
                            <tbody class="tab__tbody" id="tab_tbody">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="hide__mod">
            </div>
           <!-- 第二页-->
      </div>
      <div class="swiper-slide swiper-slide-active" style="width: 1920px;">
        <!-- <iframe src="http://10.21.40.166/task?test=213123"></iframe> -->
        <div class="task-body">
            <h2>每周任务汇总</h2>
            <div class="task-content"></div>
        </div>
      </div>
     <!--  <div class="swiper-slide swiper-slide-next" style="width: 1920px;">Slide 4</div>
      <div class="swiper-slide" style="width: 1920px;">Slide 5</div>
      <div class="swiper-slide" style="width: 1920px;">Slide 6</div>
      <div class="swiper-slide" style="width: 1920px;">Slide 7</div>
      <div class="swiper-slide" style="width: 1920px;">Slide 8</div>
      <div class="swiper-slide" style="width: 1920px;">Slide 9</div>
      <div class="swiper-slide" style="width: 1920px;">Slide 10</div>-->
    </div>
    <!-- Add Pagination -->
      <div class="swiper-pagination swiper-pagination-clickable swiper-pagination-bullets bullets-box">
          <span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 1" >1</span>
          <span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 2">2</span>
          <span class="swiper-pagination-bullet swiper-pagination-bullet-active" tabindex="0" role="button" aria-label="Go to slide 3">3</span>
     <!--      <span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 4">4</span>
          <span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 5">5</span>
          <span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 6">6</span>
          <span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 7">7</span>
          <span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 8">8</span>
          <span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 9">9</span>
          <span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 10">10</span> -->
      </div>
      <div class="set">
        <div class="set-box">
          <h1>设置</h1>
          <button id="autoplay">自动轮播</button>
        </div>
      </div>
  <span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span></div>

  <script src="js/swiper.min.js.下载"></script>
  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="js/vconsole.min.js"></script>
  <script src="js/echarts.min.js"></script>
</body>
</html>
  <script>
    window.onload=function(){
      // var d=new VConsole();
     //  //排行榜
        var rankingBox=document.getElementById('ranking');
        var data=[];
        var usersData=[];

        function getData(){

          $.ajax({
            url:'http://10.21.40.40/LQX/typingV2/config/complete.php',
            type:'post',
            data:{
              check:'check',
              rankingType:'english'
            },
            success:function(res){
              data=JSON.parse(res);
              // dataSort();
              getUser();
            },
            error:function(err){
              console.log(err)
            }
          })
        }
        getData()
        function getUser(){
          $.ajax({
            url:'http://10.21.40.40/LQX/typingV2/config/getUser.php',
            success:function(res){
              usersData=JSON.parse(res)
              // console.log(usersData)

              for(var j=0;j<usersData.length;j++){
                for(var i=0;i<data.length;i++){
                  if(data[i].username==usersData[j].name){
                    data[i].face_url=usersData[j].face_url;
                  }
                  if(data[i].username=='admin'){
                    data[i].face_url='9.png';
                  }
                }
              }
              dataSort();
              // console.log(data)
            },
            error:function(err){
              console.log(err)
            }
          })
        }

        function dataSort(){
          data.sort(function(a,b){
            if(b.dates==a.dates&&b.correct==a.correct){  //如果日期和正确率相等就按速度排序
              return b.speed-a.speed;
            }else if(b.dates==a.dates){    //如果日期相等就按正确率排序
              return b.correct-a.correct;
            }
            return a.dates<b.dates?1:-1;    //默认按日期排序
          })
          // console.log(data)
          var t=null;
          var liStr="";
          var rankingIcon="";
          rankingBox.innerHTML='';
          for(var i = 0; i < data.length; i++){    //同名次情况下
              if(t == null){
                  t =  data[i];
                  t.idx = i;
              }else{
                  var n = data[i];
                  if(n.correct == t.correct&&n.speed == t.speed&&n.dates == t.dates){
                      n.idx = t.idx;
                  }else{
                       n.idx = i;
                  }
                  t = n;
              }
              if(t.idx+1==1){
                rankingIcon='<img class="indexIcon" src="images/ranking1.png" />';
              }else if(t.idx+1==2){
                rankingIcon='<img class="indexIcon" src="images/ranking2.png" />';
              }else if(t.idx+1==3) {
                rankingIcon='<img class="indexIcon" src="images/ranking3.png" />';
              }else{
                rankingIcon='<span>'+(t.idx+1)+'</span>';
              }
              var img=new Image();
              img.src='http://10.21.40.40/star2/img/user_face/'+t.face_url;
              if(!(img.filesize>0|| (img.width > 0 && img.height > 0))){
                t.face_url='9.png';
              }
                liStr+='<li><span class="index">'+rankingIcon+'</span><span class="face"><img src="http://10.21.40.40/star2/img/user_face/'+t.face_url+'"/></span><span>'+t.username+'</span><span>'+t.correct+'%</span><span>'+t.speed+'/m</span><span class="dates">'+t.dates+'</span></li>';

          }
          rankingBox.innerHTML=liStr;
        }

        setInterval(function(){
          getData()
        },10000)
      //以上排行榜

      // 3in1
          var quarter = '2017~2018雏鹰组第二学期';

         $.get('http://10.21.40.168/test/dataApi/get_quarter/getData.php?quarter='+quarter ,function(data){


             // console.log(data)
             if(data) {
                 var chartsData = {};
                 chartsData.quarter = data.quarter;
                 if (data.score.length != 0) {
                     var user_data = [];
                     var score_data = [];

                     var newdata = userquarterFn(data.score);
                     for (item in newdata) {
                         console.log(item,newdata)
                         if (newdata[item] && typeof newdata[item]['name']!=='function' && newdata[item]['name']!='') {
                             $(".tab__tbody").append("<tr><td><p>" + newdata[item]['name'] + "</p></td><td><p>" + newdata[item]['total'] + " </p></td></tr>");
                             score_data.push(newdata[item]['total'])
                             user_data.push(newdata[item]['name'])
                         }
                     }
                     chartsData.user_data = user_data;
                     chartsData.score_data = score_data;
                     var myChart = echarts.init(document.getElementById('barChart'));
                     chartsFn(myChart, chartsData);
                     return;
                 }
             }
             $("#main").hide();
             $("#hide__mod").show();
             if(!data){
                 $("#hide__mod").append("<div>暂无此季度。</div>")
                 return false;
             }
             $("#hide__mod").append('<div class="text-center"><br><br><br><br><br><p class="soon_title">即将展开</p><br><br><p class="soon_quarter">'+data.quarter.quarterName+'</p><br><p>参与人员</p><p class="soon_users">'+data.quarter.quarterUsers+'</p></div>')

         });

        function  userquarterFn(data){
            var newdata = [];
            for(var i = 0 ; i < data.length ; i++){
                var itemusers = data[i]['scoreUsers'].split(',');
                var itemscores = data[i]['scoreArrays'].split(',');
                for(var user_item in itemusers) {
                    if(newdata[itemusers[user_item]] == undefined){
                        newdata[itemusers[user_item]] = { total: 0, name: itemusers[user_item]};
                    }
                    newdata[itemusers[user_item]]['total'] += itemscores[user_item] * 1;
                }
            }
            return newdata;
        }

        function chartsFn(myChart,data){

            // 基于准备好的dom，初始化echarts实例
            // 指定图表的配置项和数据
            var option = {
                title: {
                    text: data.quarter['quarterName']
                },
                tooltip: {},
                xAxis: {

                    data: data.user_data,
                    nameTextStyle:{
                        Color : 'red'
                    },

                    axisLabel: {
                        interval: 0,
                        margin: 10,
                        rotate: -40,

                    }

                },

                yAxis: {},
                series: [{
                    name: '分数',
                    type: 'bar',
                    data: data.score_data,
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                }],
                label:{
                    show: true,
                    position: 'top',
                }
            };
            // // // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option);

            window.onresize = function(){
                myChart.resize();
            }

        }
      //以上 3in1


      //任务
       var uuid = [];
      function loop() {
        $.get('http://10.21.40.166/task_manage/', function (data) {
          for (var i = 0; i < data.length; i++) {
            if (uuid.indexOf(data[i].id) === -1) {
              var html = ' <div class="task-item"><div class="task-name">' + data[i].name + '</div><div class="split"></div><div class="task-desc">' + data[i].content + '</div>';
              $('.task-content').append(html);
              uuid.push(data[i].id)
            }
          }
        })
      }

      loop();
      setInterval(loop, 5000)

      //滚动框架
      //
      var play=true;
      var autoplays={
        speed:800,
        autoplay: { // 轮播
          delay: 5000,
          stopOnLastSlide: false,
          disableOnInteraction: false,
          },
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
          renderBullet: function (index, className) {
            return '<span class="' + className + '">' + (index + 1) + '</span>';
          },
        },
      }


      var swiper = new Swiper('.swiper-container',autoplays );

      var autoplayButton=document.getElementById('autoplay');

      autoplayButton.onclick=function(){
        if(play){
          play=false;
          autoplayButton.innerHTML ="不轮播"
          swiper.autoplay.stop();
        }else{
          play=true;
          autoplayButton.innerHTML ="自动轮播"
          swiper.autoplay.start();
        }

      }

    }
  </script>